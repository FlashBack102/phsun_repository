<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	    
<mapper namespace="com.example.start.board.persistence.BoardDAO">
	<delete id="boardDelete" parameterType="Integer">
		DELETE FROM board
		 WHERE board_num=#{boardNum}
	</delete>
	
	<select id="boardUpdate" parameterType="Integer" resultType="BoardVO">
		SELECT *
		  FROM board
		 WHERE board_num=#{boardNum}
	</select>
	
	<update id="boardUpdatePro" parameterType="java.util.Map">
		UPDATE board
		   SET board_subject=#{subject},
		       board_content=#{content},
		       board_file=#{file}
		 WHERE board_num=#{boardNum}
	</update>
	
	<select id="boardSearch" parameterType="java.util.Map" resultType="BoardVO">
		<![CDATA[
			SELECT *
			  FROM board
			 WHERE UPPER(${type}) LIKE UPPER('%'||#{search}||'%')
		]]>
	</select>
	
	<select id="boardSearchList" parameterType="java.util.Map" resultType="BoardVO">
		<![CDATA[
			SELECT *
			  FROM (SELECT RowNum rNum, b.*
			  		  FROM (SELECT *
			  		  	      FROM board
			  		  	     WHERE UPPER(${type}) 
			  		  	      LIKE UPPER('%'||#{search}||'%')
			  		  	     ORDER BY board_num DESC
			  		  	   ) b)
			 WHERE rNum>=#{startNum} 
			   AND rNum<=#{endNum}
		]]>
	</select>
	
	<insert id="commentRegister" parameterType="java.util.Map">
		INSERT INTO board_comment(comment_num,
								  comment_writer,
								  comment_content,
								  board_num,
								  comment_ref)
		VALUES (comment_seq.nextVal,
				#{id},
				#{comment},
				#{boardNum},
				comment_seq.currVal)
	</insert>
	
	<select id="boardCommentList" resultType="CommentVO" parameterType="integer">
		SELECT * 
		  FROM board_comment
		 WHERE board_num=#{boardNum}
		 ORDER BY comment_num ASC
	</select>
	
	<delete id="commentDelete" parameterType="Integer">
		DELETE FROM board_comment
		 WHERE comment_num=#{commentNum}
	</delete>
	
	<insert id="replyRegister" parameterType="java.util.Map">
		INSERT INTO board_comment(comment_num,
								  comment_writer,
								  comment_content,
								  board_num,
								  comment_ref,
								  comment_level,
								  comment_length)
		VALUES (comment_seq.nextVal,
			    #{id},
			    #{content},
			    #{boardNum},
			    #{ref},
			    #{level},
			    #{length})
	</insert>
</mapper>